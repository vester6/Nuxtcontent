import{_ as O}from"./CbiiPMqG.js";import{l as L,J as j,c as B,R as q,f as p,k as g,i as n,g as z,S as D,t as b,F as T,H as A,x as E,I as H,M as x,h as N,w as R,A as V}from"./DRowYQrR.js";import{u as U}from"./B_SdYzFx.js";const G={class:"recipe-container"},J={class:"recipe-header-container"},K={class:"recipe-header-content"},W={class:"recipe-meta"},Q={class:"servings-control"},X={class:"servings-adjuster"},Y=["disabled"],Z={class:"recipe-content"},ee={class:"structured-content"},te={class:"ingredients-content"},ne={class:"steps-content"},re={key:0,class:"recipe-tips"},se={__name:"RecipeRenderer",props:{recipe:{type:Object,required:!0}},setup(I){const t=I,y=j(()=>t.recipe.meta&&t.recipe.meta.servings?parseInt(t.recipe.meta.servings)||4:t.recipe.servings&&parseInt(t.recipe.servings)||4),v=B(y.value),$=j(()=>v.value/y.value);function S(e){v.value=Math.max(1,v.value+e)}q(()=>t.recipe,()=>{v.value=y.value},{deep:!0});const h=e=>{try{return t.recipe.meta&&t.recipe.meta[e]!==void 0?t.recipe.meta[e]:t.recipe[e]!==void 0?t.recipe[e]:"?"}catch(r){return console.error("Error getting metadata value:",r),"?"}},w=e=>{if($.value===1)return e;console.log(`Scaling: ${e} with factor ${$.value}`);const r=/^(\d+(?:[.,]\d+)?(?:\/\d+)?)\s*(\w+)?\s+(.+)$/,s=e.match(r);if(s){let[i,d,u,a]=s;console.log(`Matched: amount=${d}, unit=${u}, rest=${a}`);let o;if(d.includes("/")){const[k,m]=d.split("/");o=parseFloat(k)/parseFloat(m)}else o=parseFloat(d.replace(",","."));if(isNaN(o))return console.log("Failed to parse amount:",d),e;const c=o*$.value;console.log(`New amount: ${c}`);let f;if(Number.isInteger(c))f=c.toString();else if(Math.abs(c-Math.round(c*2)/2)<.01){const k=Math.floor(c);k===0?f="½":f=`${k}½`}else if(Math.abs(c-Math.round(c*4)/4)<.01){const k=Math.round(c*4),m=Math.floor(k/4),M=k%4;M===0?f=m.toString():M===1?f=m===0?"¼":`${m}¼`:M===2?f=m===0?"½":`${m}½`:f=m===0?"¾":`${m}¾`}else f=c.toFixed(1).replace(/\.0$/,"");return u?`${f} ${u} ${a}`:`${f} ${a}`}return e},C=()=>{if(console.log("Getting ingredients list. Current servings:",v.value),!t.recipe.body)return[];let e=[],r="";if(typeof t.recipe.body=="string")r=t.recipe.body;else if(t.recipe.body.children)try{let i=!1,d=!1;const u=a=>{for(const o of a||[]){if(o.tag==="h2"){const c=_(o);if(c&&c.toLowerCase().includes("ingrediens")){i=!0;continue}else if(i)break}if(i&&o.tag==="ul"){d=!0;for(const c of o.children||[])c.tag==="li"&&e.push(_(c));break}o.children&&u(o.children)}};u(t.recipe.body.children),!d&&typeof t.recipe._rawString=="string"&&(r=t.recipe._rawString)}catch(i){console.error("Fejl ved parsing af ingredienser:",i)}if(e.length===0&&r){const i=r.match(/## Ingredienser\s+([\s\S]*?)(?=\s*##|$)/i);if(i&&i[1]){const d=i[1].trim().split(`
`);for(const u of d){const a=u.trim();a&&a.startsWith("-")&&e.push(a.substring(1).trim())}}}e.length===0&&(e=["2 spsk olie eller ghee","1 løg, hakket","2 fed hvidløg, knust","1 spsk frisk ingefær, revet"]),console.log("Original ingredients:",e);const s=e.map(w);return console.log("Scaled ingredients:",s),s},P=j(()=>C().map(w)),l=()=>{if(!t.recipe.body)return[];let e=[],r="";if(typeof t.recipe.body=="string")r=t.recipe.body;else if(t.recipe.body.children)try{let s=!1,i=!1;const d=u=>{for(const a of u||[]){if(a.tag==="h2"){const o=_(a);if(o&&o.toLowerCase().includes("fremgangsmåde")){s=!0;continue}else if(s)break}if(s&&a.tag==="ol"){i=!0;for(const o of a.children||[])o.tag==="li"&&e.push(_(o));break}a.children&&d(a.children)}};d(t.recipe.body.children),!i&&typeof t.recipe._rawString=="string"&&(r=t.recipe._rawString)}catch(s){console.error("Fejl ved parsing af fremgangsmåde:",s)}if(e.length===0&&r){const s=r.match(/## Fremgangsmåde\s+([\s\S]*?)(?=\s*##|$)/i);if(s&&s[1]){const i=s[1].trim().split(`
`);for(const d of i){const u=d.trim();u&&/^\d+\./.test(u)&&e.push(u.replace(/^\d+\.\s*/,"").trim())}}}return e.length===0&&(e=["Varm olie i en gryde og svits løg, hvidløg og ingefær.","Tilsæt tomater og krydderier og lad simre i 10 minutter.","Tilsæt hovedingrediensen og lad simre i yderligere minutter.","Smag til og server med ris eller brød."]),e};function _(e){return e?e.value?e.value:e.children?e.children.map(r=>_(r)).join(""):"":""}function F(){return recipe.image?{backgroundImage:`url(${recipe.image})`,backgroundSize:"cover",backgroundPosition:"center"}:{backgroundImage:"url('/almaskoekken.png')",backgroundSize:"cover",backgroundPosition:"center"}}return(e,r)=>(g(),p("div",G,[n("div",J,[n("div",{class:"header-background",style:D(F())},null,4),n("div",K,[n("h1",null,b(I.recipe.title),1),n("div",W,[n("span",null,"Tid i alt "+b(h("time"))+" min.",1),n("span",null,"Arbejdstid "+b(h("prepTime"))+" min.",1),n("div",Q,[r[2]||(r[2]=n("span",null,"Personer",-1)),n("div",X,[n("button",{onClick:r[0]||(r[0]=s=>S(-1)),class:"adjust-btn",disabled:v.value<=1},"-",8,Y),n("span",null,b(v.value),1),n("button",{onClick:r[1]||(r[1]=s=>S(1)),class:"adjust-btn"},"+")])])])])]),n("div",Z,[r[3]||(r[3]=n("div",{class:"recipe-headings"},[n("h2",{class:"ingredients-heading"},"Ingredienser"),n("h2",{class:"steps-heading"},"Fremgangsmåde")],-1)),n("div",ee,[n("div",te,[n("ul",null,[(g(!0),p(T,null,A(P.value,(s,i)=>(g(),p("li",{key:"ing"+i},b(s),1))),128))])]),n("div",ne,[n("ol",null,[(g(!0),p(T,null,A(l(),(s,i)=>(g(),p("li",{key:"step"+i},b(s),1))),128))])])])]),h("tips")?(g(),p("div",re,[r[4]||(r[4]=n("h3",null,"Tips",-1)),n("p",null,b(h("tips")),1)])):z("",!0)]))}},ie=L(se,[["__scopeId","data-v-5bd1f5b2"]]),oe={key:0,class:"loading-container"},le={key:1,class:"error-container"},ae={key:2},ce={key:3,class:"error-container"},de={__name:"[name]",async setup(I){let t,y;const $=E().params.name,S=`/opskrifter/${$}`,{data:h,pending:w,error:C}=([t,y]=H(()=>U(`recipe-${$}`,()=>queryContent(S).first())),t=await t,y(),t);return console.log("Opskrift indlæst:",h.value),(P,l)=>{const _=O,F=ie;return g(),p("div",null,[x(w)?(g(),p("div",oe,l[0]||(l[0]=[n("div",{class:"loader"},null,-1),n("p",null,"Indlæser opskrift...",-1)]))):x(C)?(g(),p("div",le,[l[2]||(l[2]=n("h2",null,"Ups! Der opstod en fejl",-1)),l[3]||(l[3]=n("p",null,"Kunne ikke finde opskriften. Prøv at opdatere siden eller gå tilbage til forsiden.",-1)),N(_,{to:"/",class:"back-link"},{default:R(()=>l[1]||(l[1]=[V("Tilbage til forsiden")])),_:1})])):x(h)?(g(),p("div",ae,[N(F,{recipe:x(h)},null,8,["recipe"])])):(g(),p("div",ce,[l[5]||(l[5]=n("h2",null,"Opskrift ikke fundet",-1)),l[6]||(l[6]=n("p",null,"Vi kunne ikke finde opskriften. Prøv at opdatere siden eller vælg en anden opskrift.",-1)),N(_,{to:"/",class:"back-link"},{default:R(()=>l[4]||(l[4]=[V("Tilbage til forsiden")])),_:1})]))])}}},fe=L(de,[["__scopeId","data-v-faf4e4a4"]]);export{fe as default};
