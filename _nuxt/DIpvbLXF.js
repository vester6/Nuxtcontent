import{l as G,J as H,c as C,K as x,o as X,f as i,i as a,F as h,H as v,L as M,M as Y,N as F,k as r,t as c,P as Z,g as $,Q as ee,n as te,O as se}from"./BEhPD5dd.js";import{u as ne}from"./C5aerB6Q.js";import"./B6u1AKxV.js";import"./B_kigFpv.js";const ae={class:"meal-planner-page"},oe={class:"planner-container"},ie={class:"days-container"},re={class:"day-title"},le=["onDrop"],ce={key:0,class:"empty-day"},de={class:"meal-header"},ue=["onClick"],ge={class:"meal-desc"},pe={class:"meal-meta"},me=["href"],fe={class:"shopping-list"},he={key:0,class:"empty-list"},ve={key:1,class:"shopping-items"},ke={class:"category-title"},ye={class:"item-label"},_e=["onUpdate:modelValue"],be={class:"available-recipes"},we={class:"search-container"},Ce={class:"recipe-grid"},Se={key:0,class:"loading-container"},Le={key:1,class:"error-container"},Ie=["onDragstart"],De={class:"time-badge"},xe={key:0,class:"category-badge"},Me={class:"recipe-card-content"},Fe={class:"description"},$e={__name:"madplan",async setup(Ne){let k,S;const{data:b,pending:N,error:O}=([k,S]=H(()=>ne("/api/recipes","$4WUDA51bWu")),k=await k,S(),k),j=[{id:"mon",name:"Mandag"},{id:"tue",name:"Tirsdag"},{id:"wed",name:"Onsdag"},{id:"thu",name:"Torsdag"},{id:"fri",name:"Fredag"},{id:"sat",name:"Lørdag"},{id:"sun",name:"Søndag"}],l=C({}),d=C([]),y=C(""),q={Grøntsager:["løg","hvidløg","tomat","kartoffel","gulerod","peberfrugt","salat","agurk","squash","aubergine"],Frugt:["æble","banan","citron","lime","appelsin","bær","jordbær","hindbær","blåbær"],Kød:["kylling","oksekød","svinekød","hakket","bacon","pølser","lam"],"Fisk & Skaldyr":["laks","torsk","rejer","tun","fisk"],Mejeriprodukter:["mælk","fløde","ost","smør","yoghurt","cremefraiche"],Bagning:["mel","sukker","gær","bagepulver","vaniljesukker","chokolade"],Kolonial:["pasta","ris","couscous","bulgur","linser","bønner"],Krydderier:["salt","peber","karry","paprika","chili","kanel","vanille"]},K=x(()=>{const e={};return d.value.forEach(t=>{let s="Andet";for(const[n,o]of Object.entries(q))if(o.some(u=>t.name.toLowerCase().includes(u.toLowerCase()))){s=n;break}e[s]||(e[s]=[]),e[s].push(t)}),e}),P=x(()=>{if(!b.value)return[];if(!y.value)return b.value;const e=y.value.toLowerCase();return b.value.filter(t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.categories&&t.categories.some(s=>s.toLowerCase().includes(e)))}),L=e=>l.value[e]||[],T=(e,t)=>{e.dataTransfer.setData("recipe",JSON.stringify(t))},J=(e,t)=>{const s=e.dataTransfer.getData("recipe");if(s){const n=JSON.parse(s);l.value[t]||(l.value[t]=[]);const o={...n,id:`${n.slug}-${Date.now()}`};l.value[t].push(o),I(),w()}},U=(e,t)=>{l.value[e]&&(l.value[e]=l.value[e].filter(s=>s.id!==t),I(),w())},I=()=>{localStorage.setItem("almasKokken_mealPlan",JSON.stringify(l.value))},W=()=>{const e=localStorage.getItem("almasKokken_mealPlan");e&&(l.value=JSON.parse(e),w())},w=async()=>{d.value=[];for(const e in l.value){const t=l.value[e];for(const s of t)try{const o=await(await fetch(`/api/recipe?name=${s.slug.split("/").pop()}`)).json();if(o){console.log("Fetched recipe data:",o);const u=l.value[e].findIndex(m=>m.id===s.id);u!==-1&&(l.value[e][u]={...l.value[e][u],content:o.content});const g=B(o);V(g)}}catch(n){console.error("Error fetching recipe:",n)}}D()},B=e=>{if(!e||!e.content&&!e.body)return console.log("No content to parse ingredients from:",e),[];const t=e.body||e.content;console.log("Parsing ingredients from:",t);const s=[],n=t.split(`
`);let o=!1;for(const u of n){const g=u.trim();if(g.includes("# Ingredienser")||g.includes("## Ingredienser")){o=!0;continue}if(o&&g.startsWith("#")){o=!1;continue}if(o&&(g.startsWith("-")||g.startsWith("*"))){const m=g.substring(1).trim(),f=m.match(/^(\d+(?:[\.,]\d+)?)\s*(\w+)?/);let p="1",_=m;f&&(p=f[1],f[2]?(p=`${p} ${f[2]}`,_=m.substring(f[0].length).trim()):_=m.substring(p.length).trim()),s.push({name:_,amount:p,quantity:parseFloat(p)||1,checked:!1,recipe:e.title||"Ukendt opskrift"}),console.log("Added ingredient:",_,"with amount:",p)}}return console.log("Found ingredients:",s),s},V=e=>{for(const t of e){const s=d.value.findIndex(n=>n.name.toLowerCase()===t.name.toLowerCase());if(s!==-1){const n=d.value[s];if(n.quantity&&t.quantity)if(n.quantity+=t.quantity,n.amount.includes(" ")){const o=n.amount.split(" ")[1];n.amount=`${n.quantity} ${o}`}else n.amount=String(n.quantity);else n.recipes||(n.recipes=[n.recipe]),n.recipes.includes(t.recipe)||n.recipes.push(t.recipe)}else t.recipes=[t.recipe],d.value.push(t)}},A=()=>{d.value=d.value.filter(e=>!e.checked),D()},D=()=>{localStorage.setItem("almasKokken_shoppingList",JSON.stringify(d.value))},z=()=>{const e=localStorage.getItem("almasKokken_shoppingList");e&&(d.value=JSON.parse(e))},E=()=>{window.print()},Q=e=>{if(e.image)return{backgroundImage:`url(${e.image})`};let t="category-default";if(e.categories&&e.categories.length>0){const s=e.categories[0].toLowerCase();s.includes("dessert")?t="category-dessert":s.includes("bagværk")?t="category-bagvaerk":s.includes("tradition")?t="category-tradition":s.includes("international")&&(t="category-international")}return{backgroundColor:R(t)}},R=e=>{switch(e){case"category-dessert":return"#f9d5e5";case"category-bagvaerk":return"#eeac99";case"category-tradition":return"#e06377";case"category-international":return"#5b9aa0";default:return"#d8e2dc"}};return X(()=>{W(),z()}),(e,t)=>(r(),i("div",ae,[t[6]||(t[6]=a("h1",{class:"page-title"},"Ugentlig Madplan",-1)),a("div",oe,[a("div",ie,[(r(),i(h,null,v(j,s=>a("div",{key:s.id,class:"day-column"},[a("h2",re,c(s.name),1),a("div",{class:"meal-dropzone",onDragover:t[0]||(t[0]=Z(()=>{},["prevent"])),onDrop:n=>J(n,s.id)},[L(s.id).length?$("",!0):(r(),i("div",ce," Træk opskrifter hertil ")),(r(!0),i(h,null,v(L(s.id),n=>(r(),i("div",{key:n.id,class:"planned-meal"},[a("div",de,[a("h3",null,c(n.title),1),a("button",{class:"remove-btn",onClick:o=>U(s.id,n.id)},"×",8,ue)]),a("p",ge,c(n.description),1),a("div",pe,[a("span",null,c(n.time||30)+" min",1),a("span",null,c(n.servings||4)+" pers.",1)]),a("a",{href:n.slug,class:"view-recipe"},"Se opskrift",8,me)]))),128))],40,le)])),64))]),a("div",fe,[t[2]||(t[2]=a("h2",null,"Indkøbsliste",-1)),d.value.length?(r(),i("div",ve,[(r(!0),i(h,null,v(K.value,(s,n)=>(r(),i("div",{key:n,class:"category-group"},[a("h3",ke,c(n),1),(r(!0),i(h,null,v(s,o=>(r(),i("div",{key:o.name,class:"shopping-item"},[a("label",ye,[M(a("input",{type:"checkbox","onUpdate:modelValue":u=>o.checked=u},null,8,_e),[[ee,o.checked]]),a("span",{class:te({checked:o.checked})},c(o.name)+" "+c(o.amount?`(${o.amount})`:""),3)])]))),128))]))),128)),a("div",{class:"shopping-actions"},[a("button",{class:"clear-btn",onClick:A},"Fjern markerede varer"),a("button",{class:"print-btn",onClick:E},"Udskriv indkøbsliste")])])):(r(),i("div",he," Din indkøbsliste er tom. Tilføj opskrifter til madplanen for at generere en indkøbsliste. "))])]),a("div",be,[t[5]||(t[5]=a("h2",null,"Tilgængelige Opskrifter",-1)),a("div",we,[M(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),placeholder:"Søg efter opskrifter...",class:"search-input"},null,512),[[Y,y.value]])]),a("div",Ce,[F(N)?(r(),i("div",Se,t[3]||(t[3]=[a("div",{class:"loader"},null,-1),a("p",null,"Indlæser opskrifter...",-1)]))):F(O)?(r(),i("div",Le,t[4]||(t[4]=[a("h2",null,"Kunne ikke indlæse opskrifter",-1),a("p",null,"Der opstod en fejl. Prøv at genindlæse siden.",-1)]))):(r(!0),i(h,{key:2},v(P.value,s=>(r(),i("div",{key:s.slug,class:"recipe-card",draggable:"true",onDragstart:n=>T(n,s)},[a("div",{class:"recipe-card-image",style:se(Q(s))},[a("div",De,c(s.time||30)+" min",1),s.categories&&s.categories.length>0?(r(),i("div",xe,c(s.categories[0]),1)):$("",!0)],4),a("div",Me,[a("h3",null,c(s.title),1),a("p",Fe,c(s.description),1)])],40,Ie))),128))])])]))}},Pe=G($e,[["__scopeId","data-v-50a5f03e"]]);export{Pe as default};
