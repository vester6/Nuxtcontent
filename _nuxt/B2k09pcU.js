import{l as q,J as Q,c as _,K as S,o as R,f as r,i as n,F as g,H as p,L,M as G,N as I,k as i,t as d,P as H,g as D,Q as X,n as Y,O as Z}from"./Jfa0KLRP.js";import{u as ee}from"./CTJj6QqR.js";import"./5WPk9I02.js";import"./BmL9ck2M.js";const te={class:"meal-planner-page"},se={class:"planner-container"},ne={class:"days-container"},ae={class:"day-title"},oe=["onDrop"],re={key:0,class:"empty-day"},ie={class:"meal-header"},le=["onClick"],ce={class:"meal-desc"},de={class:"meal-meta"},ue=["href"],ge={class:"shopping-list"},pe={key:0,class:"empty-list"},me={key:1,class:"shopping-items"},ve={class:"category-title"},fe={class:"item-label"},ke=["onUpdate:modelValue"],he={class:"available-recipes"},_e={class:"search-container"},ye={class:"recipe-grid"},be={key:0,class:"loading-container"},we={key:1,class:"error-container"},Ce=["onDragstart"],Se={class:"time-badge"},Le={key:0,class:"category-badge"},Ie={class:"recipe-card-content"},De={class:"description"},xe={__name:"madplan",async setup(Me){let m,y;const{data:k,pending:x,error:M}=([m,y]=Q(()=>ee("/api/recipes","$4WUDA51bWu")),m=await m,y(),m),F=[{id:"mon",name:"Mandag"},{id:"tue",name:"Tirsdag"},{id:"wed",name:"Onsdag"},{id:"thu",name:"Torsdag"},{id:"fri",name:"Fredag"},{id:"sat",name:"Lørdag"},{id:"sun",name:"Søndag"}],l=_({}),u=_([]),v=_(""),N={Grøntsager:["løg","hvidløg","tomat","kartoffel","gulerod","peberfrugt","salat","agurk","squash","aubergine"],Frugt:["æble","banan","citron","lime","appelsin","bær","jordbær","hindbær","blåbær"],Kød:["kylling","oksekød","svinekød","hakket","bacon","pølser","lam"],"Fisk & Skaldyr":["laks","torsk","rejer","tun","fisk"],Mejeriprodukter:["mælk","fløde","ost","smør","yoghurt","cremefraiche"],Bagning:["mel","sukker","gær","bagepulver","vaniljesukker","chokolade"],Kolonial:["pasta","ris","couscous","bulgur","linser","bønner"],Krydderier:["salt","peber","karry","paprika","chili","kanel","vanille"]},O=S(()=>{const e={};return u.value.forEach(t=>{let s="Andet";for(const[a,o]of Object.entries(N))if(o.some(c=>t.name.toLowerCase().includes(c.toLowerCase()))){s=a;break}e[s]||(e[s]=[]),e[s].push(t)}),e}),j=S(()=>{if(!k.value)return[];if(!v.value)return k.value;const e=v.value.toLowerCase();return k.value.filter(t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.categories&&t.categories.some(s=>s.toLowerCase().includes(e)))}),b=e=>l.value[e]||[],K=(e,t)=>{e.dataTransfer.setData("recipe",JSON.stringify(t))},P=(e,t)=>{const s=e.dataTransfer.getData("recipe");if(s){const a=JSON.parse(s);l.value[t]||(l.value[t]=[]);const o={...a,id:`${a.slug}-${Date.now()}`};l.value[t].push(o),w(),h()}},T=(e,t)=>{l.value[e]&&(l.value[e]=l.value[e].filter(s=>s.id!==t),w(),h())},w=()=>{localStorage.setItem("almasKokken_mealPlan",JSON.stringify(l.value))},$=()=>{const e=localStorage.getItem("almasKokken_mealPlan");e&&(l.value=JSON.parse(e),h())},h=async()=>{u.value=[];for(const e in l.value){const t=l.value[e];for(const s of t)try{const o=await(await fetch(`/api/recipe?name=${s.slug.split("/").pop()}`)).json();if(o){console.log("Fetched recipe data:",o);const c=l.value[e].findIndex(E=>E.id===s.id);c!==-1&&(l.value[e][c]={...l.value[e][c],content:o.content});const f=J(o);U(f)}}catch(a){console.error("Error fetching recipe:",a)}}C()},J=e=>{if(!e||!e.content)return console.log("No content to parse ingredients from:",e),[];console.log("Parsing ingredients from:",e.content);const t=[],s=e.content.split(`
`);let a=!1;for(const o of s){const c=o.trim();if(c.includes("# Ingredienser")||c.includes("## Ingredienser")){a=!0;continue}if(a&&c.startsWith("#")){a=!1;continue}if(a&&(c.startsWith("-")||c.startsWith("*"))){const f=c.substring(1).trim();t.push({name:f,amount:"1",checked:!1,recipe:e.title||"Ukendt opskrift"}),console.log("Added ingredient:",f)}}return console.log("Found ingredients:",t),t},U=e=>{for(const t of e){const s=u.value.findIndex(a=>a.name.toLowerCase()===t.name.toLowerCase());s!==-1?(u.value[s].amount+=`, ${t.amount}`,u.value[s].recipe+=`, ${t.recipe}`):u.value.push(t)}},W=()=>{u.value=u.value.filter(e=>!e.checked),C()},C=()=>{localStorage.setItem("almasKokken_shoppingList",JSON.stringify(u.value))},B=()=>{const e=localStorage.getItem("almasKokken_shoppingList");e&&(u.value=JSON.parse(e))},V=()=>{window.print()},A=e=>{if(e.image)return{backgroundImage:`url(${e.image})`};let t="category-default";if(e.categories&&e.categories.length>0){const s=e.categories[0].toLowerCase();s.includes("dessert")?t="category-dessert":s.includes("bagværk")?t="category-bagvaerk":s.includes("tradition")?t="category-tradition":s.includes("international")&&(t="category-international")}return{backgroundColor:z(t)}},z=e=>{switch(e){case"category-dessert":return"#f9d5e5";case"category-bagvaerk":return"#eeac99";case"category-tradition":return"#e06377";case"category-international":return"#5b9aa0";default:return"#d8e2dc"}};return R(()=>{$(),B()}),(e,t)=>(i(),r("div",te,[t[6]||(t[6]=n("h1",{class:"page-title"},"Ugentlig Madplan",-1)),n("div",se,[n("div",ne,[(i(),r(g,null,p(F,s=>n("div",{key:s.id,class:"day-column"},[n("h2",ae,d(s.name),1),n("div",{class:"meal-dropzone",onDragover:t[0]||(t[0]=H(()=>{},["prevent"])),onDrop:a=>P(a,s.id)},[b(s.id).length?D("",!0):(i(),r("div",re," Træk opskrifter hertil ")),(i(!0),r(g,null,p(b(s.id),a=>(i(),r("div",{key:a.id,class:"planned-meal"},[n("div",ie,[n("h3",null,d(a.title),1),n("button",{class:"remove-btn",onClick:o=>T(s.id,a.id)},"×",8,le)]),n("p",ce,d(a.description),1),n("div",de,[n("span",null,d(a.time||30)+" min",1),n("span",null,d(a.servings||4)+" pers.",1)]),n("a",{href:a.slug,class:"view-recipe"},"Se opskrift",8,ue)]))),128))],40,oe)])),64))]),n("div",ge,[t[2]||(t[2]=n("h2",null,"Indkøbsliste",-1)),u.value.length?(i(),r("div",me,[(i(!0),r(g,null,p(O.value,(s,a)=>(i(),r("div",{key:a,class:"category-group"},[n("h3",ve,d(a),1),(i(!0),r(g,null,p(s,o=>(i(),r("div",{key:o.name,class:"shopping-item"},[n("label",fe,[L(n("input",{type:"checkbox","onUpdate:modelValue":c=>o.checked=c},null,8,ke),[[X,o.checked]]),n("span",{class:Y({checked:o.checked})},d(o.name)+" ("+d(o.amount)+")",3)])]))),128))]))),128)),n("div",{class:"shopping-actions"},[n("button",{class:"clear-btn",onClick:W},"Fjern markerede varer"),n("button",{class:"print-btn",onClick:V},"Udskriv indkøbsliste")])])):(i(),r("div",pe," Din indkøbsliste er tom. Tilføj opskrifter til madplanen for at generere en indkøbsliste. "))])]),n("div",he,[t[5]||(t[5]=n("h2",null,"Tilgængelige Opskrifter",-1)),n("div",_e,[L(n("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),placeholder:"Søg efter opskrifter...",class:"search-input"},null,512),[[G,v.value]])]),n("div",ye,[I(x)?(i(),r("div",be,t[3]||(t[3]=[n("div",{class:"loader"},null,-1),n("p",null,"Indlæser opskrifter...",-1)]))):I(M)?(i(),r("div",we,t[4]||(t[4]=[n("h2",null,"Kunne ikke indlæse opskrifter",-1),n("p",null,"Der opstod en fejl. Prøv at genindlæse siden.",-1)]))):(i(!0),r(g,{key:2},p(j.value,s=>(i(),r("div",{key:s.slug,class:"recipe-card",draggable:"true",onDragstart:a=>K(a,s)},[n("div",{class:"recipe-card-image",style:Z(A(s))},[n("div",Se,d(s.time||"30")+" min",1),s.categories&&s.categories.length>0?(i(),r("div",Le,d(s.categories[0]),1)):D("",!0)],4),n("div",Ie,[n("h3",null,d(s.title),1),n("p",De,d(s.description),1)])],40,Ce))),128))])])]))}},Ke=q(xe,[["__scopeId","data-v-104b9ffb"]]);export{Ke as default};
