import{l as R,J as G,c as _,K as D,o as H,f as i,i as a,F as p,H as m,L as I,M as Y,N as x,k as r,t as c,P as Z,g as M,Q as X,n as ee,O as te}from"./cY_kfgR1.js";import{u as O}from"./BpxbnUpZ.js";import"./gjd2WRri.js";import"./hOn5actF.js";const se={class:"meal-planner-page"},ae={class:"planner-container"},ne={class:"days-container"},oe={class:"day-title"},ie=["onDrop"],re={key:0,class:"empty-day"},le={class:"meal-header"},ce=["onClick"],de={class:"meal-desc"},ue={class:"meal-meta"},ge=["href"],pe={class:"shopping-list"},me={key:0,class:"empty-list"},ve={key:1,class:"shopping-items"},ke={class:"category-title"},he={class:"item-label"},fe=["onUpdate:modelValue"],_e={class:"available-recipes"},ye={class:"search-container"},be={class:"recipe-grid"},Ce={key:0,class:"loading-container"},we={key:1,class:"error-container"},Se=["onDragstart"],Le={class:"time-badge"},De={key:0,class:"category-badge"},Ie={class:"recipe-card-content"},xe={class:"description"},Me={__name:"madplan",async setup(Oe){let v,y;const{data:h,pending:T,error:$}=([v,y]=G(()=>O("/api/recipes","$4WUDA51bWu")),v=await v,y(),v),K=[{id:"mon",name:"Mandag"},{id:"tue",name:"Tirsdag"},{id:"wed",name:"Onsdag"},{id:"thu",name:"Torsdag"},{id:"fri",name:"Fredag"},{id:"sat",name:"Lørdag"},{id:"sun",name:"Søndag"}],l=_({}),d=_([]),k=_(""),N={Grøntsager:["løg","hvidløg","tomat","kartoffel","gulerod","peberfrugt","salat","agurk","squash","aubergine"],Frugt:["æble","banan","citron","lime","appelsin","bær","jordbær","hindbær","blåbær"],Kød:["kylling","oksekød","svinekød","hakket","bacon","pølser","lam"],"Fisk & Skaldyr":["laks","torsk","rejer","tun","fisk"],Mejeriprodukter:["mælk","fløde","ost","smør","yoghurt","cremefraiche"],Bagning:["mel","sukker","gær","bagepulver","vaniljesukker","chokolade"],Kolonial:["pasta","ris","couscous","bulgur","linser","bønner"],Krydderier:["salt","peber","karry","paprika","chili","kanel","vanille"]},j=D(()=>{const t={};return d.value.forEach(s=>{let e="Andet";for(const[n,o]of Object.entries(N))if(o.some(u=>s.name.toLowerCase().includes(u.toLowerCase()))){e=n;break}t[e]||(t[e]=[]),t[e].push(s)}),t}),F=D(()=>{if(!h.value)return[];if(!k.value)return h.value;const t=k.value.toLowerCase();return h.value.filter(s=>s.title.toLowerCase().includes(t)||s.description.toLowerCase().includes(t)||s.categories&&s.categories.some(e=>e.toLowerCase().includes(t)))}),b=t=>l.value[t]||[],P=(t,s)=>{t.dataTransfer.setData("recipe",JSON.stringify(s))},J=(t,s)=>{const e=t.dataTransfer.getData("recipe");if(e){const n=JSON.parse(e);l.value[s]||(l.value[s]=[]);const o={...n,id:`${n.slug}-${Date.now()}`};l.value[s].push(o),C(),f()}},U=(t,s)=>{l.value[t]&&(l.value[t]=l.value[t].filter(e=>e.id!==s),C(),f())},C=()=>{localStorage.setItem("almasKokken_mealPlan",JSON.stringify(l.value))},A=()=>{const t=localStorage.getItem("almasKokken_mealPlan");t&&(l.value=JSON.parse(t),f())},w=t=>{if(!t.content)return[];const s=[],e=t.content.split(`
`);for(const n of e){const o=n.trim();if(o.startsWith("-")||o.startsWith("*")){const g=o.substring(1).trim().match(/^([\d\s,./]+)?\s*([a-zæøåA-ZÆØÅ].+)$/);if(g){const q=g[1]?g[1].trim():"",E=g[2].trim();s.push({name:E,amount:q,checked:!1,recipe:t.title})}}}return s},f=async()=>{d.value=[];for(const t in l.value){const s=l.value[t];for(const e of s)if(e.content){const n=w(e);S(n)}else{const{data:n}=await O(`/api/recipe?name=${e.slug.split("/").pop()}`,"$_y5-QQ9ArY");if(n.value){const o=l.value[t].findIndex(g=>g.id===e.id);o!==-1&&(l.value[t][o]={...l.value[t][o],content:n.value.content});const u=w(n.value);S(u)}}}L()},S=t=>{for(const s of t){const e=d.value.findIndex(n=>n.name.toLowerCase()===s.name.toLowerCase());e!==-1?(d.value[e].amount+=`, ${s.amount}`,d.value[e].recipe+=`, ${s.recipe}`):d.value.push(s)}},B=()=>{d.value=d.value.filter(t=>!t.checked),L()},L=()=>{localStorage.setItem("almasKokken_shoppingList",JSON.stringify(d.value))},V=()=>{const t=localStorage.getItem("almasKokken_shoppingList");t&&(d.value=JSON.parse(t))},W=()=>{window.print()},z=t=>{if(t.image)return{backgroundImage:`url(${t.image})`};let s="category-default";if(t.categories&&t.categories.length>0){const e=t.categories[0].toLowerCase();e.includes("dessert")?s="category-dessert":e.includes("bagværk")?s="category-bagvaerk":e.includes("tradition")?s="category-tradition":e.includes("international")&&(s="category-international")}return{backgroundColor:Q(s)}},Q=t=>{switch(t){case"category-dessert":return"#f9d5e5";case"category-bagvaerk":return"#eeac99";case"category-tradition":return"#e06377";case"category-international":return"#5b9aa0";default:return"#d8e2dc"}};return H(()=>{A(),V()}),(t,s)=>(r(),i("div",se,[s[6]||(s[6]=a("h1",{class:"page-title"},"Ugentlig Madplan",-1)),a("div",ae,[a("div",ne,[(r(),i(p,null,m(K,e=>a("div",{key:e.id,class:"day-column"},[a("h2",oe,c(e.name),1),a("div",{class:"meal-dropzone",onDragover:s[0]||(s[0]=Z(()=>{},["prevent"])),onDrop:n=>J(n,e.id)},[b(e.id).length?M("",!0):(r(),i("div",re," Træk opskrifter hertil ")),(r(!0),i(p,null,m(b(e.id),n=>(r(),i("div",{key:n.id,class:"planned-meal"},[a("div",le,[a("h3",null,c(n.title),1),a("button",{class:"remove-btn",onClick:o=>U(e.id,n.id)},"×",8,ce)]),a("p",de,c(n.description),1),a("div",ue,[a("span",null,c(n.time||30)+" min",1),a("span",null,c(n.servings||4)+" pers.",1)]),a("a",{href:n.slug,class:"view-recipe"},"Se opskrift",8,ge)]))),128))],40,ie)])),64))]),a("div",pe,[s[2]||(s[2]=a("h2",null,"Indkøbsliste",-1)),d.value.length?(r(),i("div",ve,[(r(!0),i(p,null,m(j.value,(e,n)=>(r(),i("div",{key:n,class:"category-group"},[a("h3",ke,c(n),1),(r(!0),i(p,null,m(e,o=>(r(),i("div",{key:o.name,class:"shopping-item"},[a("label",he,[I(a("input",{type:"checkbox","onUpdate:modelValue":u=>o.checked=u},null,8,fe),[[X,o.checked]]),a("span",{class:ee({checked:o.checked})},c(o.name)+" ("+c(o.amount)+")",3)])]))),128))]))),128)),a("div",{class:"shopping-actions"},[a("button",{class:"clear-btn",onClick:B},"Fjern markerede varer"),a("button",{class:"print-btn",onClick:W},"Udskriv indkøbsliste")])])):(r(),i("div",me," Din indkøbsliste er tom. Tilføj opskrifter til madplanen for at generere en indkøbsliste. "))])]),a("div",_e,[s[5]||(s[5]=a("h2",null,"Tilgængelige Opskrifter",-1)),a("div",ye,[I(a("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=e=>k.value=e),placeholder:"Søg efter opskrifter...",class:"search-input"},null,512),[[Y,k.value]])]),a("div",be,[x(T)?(r(),i("div",Ce,s[3]||(s[3]=[a("div",{class:"loader"},null,-1),a("p",null,"Indlæser opskrifter...",-1)]))):x($)?(r(),i("div",we,s[4]||(s[4]=[a("h2",null,"Kunne ikke indlæse opskrifter",-1),a("p",null,"Der opstod en fejl. Prøv at genindlæse siden.",-1)]))):(r(!0),i(p,{key:2},m(F.value,e=>(r(),i("div",{key:e.slug,class:"recipe-card",draggable:"true",onDragstart:n=>P(n,e)},[a("div",{class:"recipe-card-image",style:te(z(e))},[a("div",Le,c(e.time||"30")+" min",1),e.categories&&e.categories.length>0?(r(),i("div",De,c(e.categories[0]),1)):M("",!0)],4),a("div",Ie,[a("h3",null,c(e.title),1),a("p",xe,c(e.description),1)])],40,Se))),128))])])]))}},je=R(Me,[["__scopeId","data-v-8072feae"]]);export{je as default};
