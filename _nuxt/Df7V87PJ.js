import{l as E,I as z,c as C,J as x,o as G,f as l,i as a,F as k,H as h,K as M,L as H,M as F,k as i,t as p,O as Q,g as X,P as Y,n as Z,N as ee}from"./DRowYQrR.js";import{R as te}from"./-YyKRVH6.js";import{u as se}from"./DvH14vzB.js";import"./BiL4n4AK.js";import"./B_SdYzFx.js";const ne={class:"meal-planner-page"},ae={class:"planner-container"},oe={class:"days-container"},ie={class:"day-title"},re=["onDrop"],le={key:0,class:"empty-day"},ce={class:"meal-header"},de=["onClick"],ue={class:"meal-desc"},pe={class:"meal-meta"},ge=["href"],me={class:"shopping-list"},fe={key:0,class:"empty-list"},ke={key:1,class:"shopping-items"},he={class:"category-title"},ve={class:"item-label"},_e=["onUpdate:modelValue"],ye={class:"available-recipes"},be={class:"search-container"},we={class:"recipe-grid"},Ce={key:0,class:"loading-container"},Se={key:1,class:"error-container"},Le={__name:"madplan",async setup(Ie){let v,S;const{data:b,pending:N,error:O}=([v,S]=z(()=>se("/api/recipes","$4WUDA51bWu")),v=await v,S(),v),$=[{id:"mon",name:"Mandag"},{id:"tue",name:"Tirsdag"},{id:"wed",name:"Onsdag"},{id:"thu",name:"Torsdag"},{id:"fri",name:"Fredag"},{id:"sat",name:"Lørdag"},{id:"sun",name:"Søndag"}],r=C({}),c=C([]),_=C(""),j={Grøntsager:["løg","hvidløg","tomat","kartoffel","gulerod","peberfrugt","salat","agurk","squash","aubergine"],Frugt:["æble","banan","citron","lime","appelsin","bær","jordbær","hindbær","blåbær"],Kød:["kylling","oksekød","svinekød","hakket","bacon","pølser","lam"],"Fisk & Skaldyr":["laks","torsk","rejer","tun","fisk"],Mejeriprodukter:["mælk","fløde","ost","smør","yoghurt","cremefraiche"],Bagning:["mel","sukker","gær","bagepulver","vaniljesukker","chokolade"],Kolonial:["pasta","ris","couscous","bulgur","linser","bønner"],Krydderier:["salt","peber","karry","paprika","chili","kanel","vanille"]},q=x(()=>{const t={};return c.value.forEach(e=>{let n="Andet";for(const[s,o]of Object.entries(j))if(o.some(d=>e.name.toLowerCase().includes(d.toLowerCase()))){n=s;break}t[n]||(t[n]=[]),t[n].push(e)}),t}),K=x(()=>{if(!b.value)return[];if(!_.value)return b.value;const t=_.value.toLowerCase();return b.value.filter(e=>e.title.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.categories&&e.categories.some(n=>n.toLowerCase().includes(t)))}),L=t=>r.value[t]||[],P=(t,e)=>{t.dataTransfer.setData("recipe",JSON.stringify(e))},T=(t,e)=>{const n=t.dataTransfer.getData("recipe");if(n){const s=JSON.parse(n);r.value[e]||(r.value[e]=[]);const o={...s,id:`${s.slug}-${Date.now()}`};r.value[e].push(o),I(),w()}},J=(t,e)=>{r.value[t]&&(r.value[t]=r.value[t].filter(n=>n.id!==e),I(),w())},I=()=>{localStorage.setItem("almasKokken_mealPlan",JSON.stringify(r.value))},U=()=>{const t=localStorage.getItem("almasKokken_mealPlan");t&&(r.value=JSON.parse(t),w())},w=async()=>{c.value=[];for(const t in r.value){const e=r.value[t];for(const n of e)try{const o=await(await fetch(`/api/recipe?name=${n.slug.split("/").pop()}`)).json();if(o){console.log("Fetched recipe data:",o);const d=r.value[t].findIndex(m=>m.id===n.id);d!==-1&&(r.value[t][d]={...r.value[t][d],content:o.content});const u=B(o);W(u)}}catch(s){console.error("Error fetching recipe:",s)}}D()},B=t=>{if(!t||!t.content&&!t.body)return console.log("No content to parse ingredients from:",t),[];const e=t.body||t.content;console.log("Parsing ingredients from:",e);const n=[],s=e.split(`
`);let o=!1;for(const d of s){const u=d.trim();if(u.includes("# Ingredienser")||u.includes("## Ingredienser")){o=!0;continue}if(o&&u.startsWith("#")){o=!1;continue}if(o&&(u.startsWith("-")||u.startsWith("*"))){const m=u.substring(1).trim(),f=m.match(/^(\d+(?:[\.,]\d+)?)\s*(\w+)?/);let g="1",y=m;f&&(g=f[1],f[2]?(g=`${g} ${f[2]}`,y=m.substring(f[0].length).trim()):y=m.substring(g.length).trim()),n.push({name:y,amount:g,quantity:parseFloat(g)||1,checked:!1,recipe:t.title||"Ukendt opskrift"}),console.log("Added ingredient:",y,"with amount:",g)}}return console.log("Found ingredients:",n),n},W=t=>{for(const e of t){const n=c.value.findIndex(s=>s.name.toLowerCase()===e.name.toLowerCase());if(n!==-1){const s=c.value[n];if(s.quantity&&e.quantity)if(s.quantity+=e.quantity,s.amount.includes(" ")){const o=s.amount.split(" ")[1];s.amount=`${s.quantity} ${o}`}else s.amount=String(s.quantity);else s.recipes||(s.recipes=[s.recipe]),s.recipes.includes(e.recipe)||s.recipes.push(e.recipe)}else e.recipes=[e.recipe],c.value.push(e)}},V=()=>{c.value=c.value.filter(t=>!t.checked),D()},D=()=>{localStorage.setItem("almasKokken_shoppingList",JSON.stringify(c.value))},A=()=>{const t=localStorage.getItem("almasKokken_shoppingList");t&&(c.value=JSON.parse(t))},R=()=>{window.print()};return G(()=>{U(),A()}),(t,e)=>(i(),l("div",ne,[e[6]||(e[6]=a("h1",{class:"page-title"},"Ugentlig Madplan",-1)),a("div",ae,[a("div",oe,[(i(),l(k,null,h($,n=>a("div",{key:n.id,class:"day-column"},[a("h2",ie,p(n.name),1),a("div",{class:"meal-dropzone",onDragover:e[0]||(e[0]=Q(()=>{},["prevent"])),onDrop:s=>T(s,n.id)},[L(n.id).length?X("",!0):(i(),l("div",le," Træk opskrifter hertil ")),(i(!0),l(k,null,h(L(n.id),s=>(i(),l("div",{key:s.id,class:"planned-meal"},[a("div",ce,[a("h3",null,p(s.title),1),a("button",{class:"remove-btn",onClick:o=>J(n.id,s.id)},"×",8,de)]),a("p",ue,p(s.description),1),a("div",pe,[a("span",null,p(s.time||30)+" min",1),a("span",null,p(s.servings||4)+" pers.",1)]),a("a",{href:s.slug,class:"view-recipe"},"Se opskrift",8,ge)]))),128))],40,re)])),64))]),a("div",me,[e[2]||(e[2]=a("h2",null,"Indkøbsliste",-1)),c.value.length?(i(),l("div",ke,[(i(!0),l(k,null,h(q.value,(n,s)=>(i(),l("div",{key:s,class:"category-group"},[a("h3",he,p(s),1),(i(!0),l(k,null,h(n,o=>(i(),l("div",{key:o.name,class:"shopping-item"},[a("label",ve,[M(a("input",{type:"checkbox","onUpdate:modelValue":d=>o.checked=d},null,8,_e),[[Y,o.checked]]),a("span",{class:Z({checked:o.checked})},p(o.name)+" "+p(o.amount?`(${o.amount})`:""),3)])]))),128))]))),128)),a("div",{class:"shopping-actions"},[a("button",{class:"clear-btn",onClick:V},"Fjern markerede varer"),a("button",{class:"print-btn",onClick:R},"Udskriv indkøbsliste")])])):(i(),l("div",fe," Din indkøbsliste er tom. Tilføj opskrifter til madplanen for at generere en indkøbsliste. "))])]),a("div",ye,[e[5]||(e[5]=a("h2",null,"Tilgængelige Opskrifter",-1)),a("div",be,[M(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>_.value=n),placeholder:"Søg efter opskrifter...",class:"search-input"},null,512),[[H,_.value]])]),a("div",we,[F(N)?(i(),l("div",Ce,e[3]||(e[3]=[a("div",{class:"loader"},null,-1),a("p",null,"Indlæser opskrifter...",-1)]))):F(O)?(i(),l("div",Se,e[4]||(e[4]=[a("h2",null,"Kunne ikke indlæse opskrifter",-1),a("p",null,"Der opstod en fejl. Prøv at genindlæse siden.",-1)]))):(i(!0),l(k,{key:2},h(K.value,n=>(i(),ee(te,{key:n.slug,recipe:n,draggable:!0,onDragstart:P},null,8,["recipe"]))),128))])])]))}},Oe=E(Le,[["__scopeId","data-v-80d6e6c5"]]);export{Oe as default};
